---
title: "CINmetrics and clinical variables analysis"
author: "Sasha Thalluri"
date: "8/23/2021"
output: html_document
---

This R Markdown will have the analysis to compare the CINmetrics to clinical variables. We compare the CINmetrics to metastasis, lymph node inclusion, and tumor stage (TNM) data. The output of this document will include U-test calculations between the CINmetrics and the separate TNM stages.

U-test

```{r}
library(devtools)
library(ggpubr)
library(dplyr)
library(tidyverse)
library(rstatix)
```

```{r}
load("/Volumes/G-DRIVEUSB/k99/clinical-corr/data/200831_clinical_analyses_clinical_cin.RData")
##### Data wrangling ######
unique_meta <- unique(clinical_cin$ajcc_pathologic_m)
clinical_cin$ajcc_pathologic_m <- ifelse(clinical_cin$ajcc_pathologic_m %in% "cM0 (i+)", "M0", clinical_cin$ajcc_pathologic_m)
clinical_cin$ajcc_pathologic_m <- ifelse(clinical_cin$ajcc_pathologic_m %in% c("M1a", "M1b", "M1c"), "M1", clinical_cin$ajcc_pathologic_m)
unique_node <- unique(clinical_cin$ajcc_pathologic_n)
clinical_cin$ajcc_pathologic_n <- ifelse(clinical_cin$ajcc_pathologic_n %in% c("N0 (i+)", "N0 (i-)", "N0 (mol+)"), "N0", clinical_cin$ajcc_pathologic_n)
clinical_cin$ajcc_pathologic_n <- ifelse(clinical_cin$ajcc_pathologic_n %in% c("N1mi", "N1a", "N1b", "N1c"), "N1", clinical_cin$ajcc_pathologic_n)
clinical_cin$ajcc_pathologic_n <- ifelse(clinical_cin$ajcc_pathologic_n %in% c("N2a", "N2b", "N2c"), "N2", clinical_cin$ajcc_pathologic_n)
clinical_cin$ajcc_pathologic_n <- ifelse(clinical_cin$ajcc_pathologic_n %in% c("N3a", "N3b", "N3c"), "N3", clinical_cin$ajcc_pathologic_n)
unique_stage <- unique(clinical_cin$ajcc_pathologic_t)
clinical_cin$ajcc_pathologic_t <- ifelse(clinical_cin$ajcc_pathologic_t %in% c("T1a", "T1a1", "T1b", "T1b2", "T1b1", "T1c"), "T1", clinical_cin$ajcc_pathologic_t)
clinical_cin$ajcc_pathologic_t <- ifelse(clinical_cin$ajcc_pathologic_t %in% c("T2a", "T2b", "T2c", "T2a2", "T2a1", "T2a2"), "T2", clinical_cin$ajcc_pathologic_t)
clinical_cin$ajcc_pathologic_t <- ifelse(clinical_cin$ajcc_pathologic_t %in% c("T3a", "T3b", "T3c"), "T3", clinical_cin$ajcc_pathologic_t)
clinical_cin$ajcc_pathologic_t <- ifelse(clinical_cin$ajcc_pathologic_t %in% c("T4a", "T4b", "T4c", "T4d", "T4e"), "T4", clinical_cin$ajcc_pathologic_t)
save(clinical_cin, file = "/Volumes/G-DRIVEUSB/k99/clinical-corr/data/210709_clinical_cin_clean.RData")
```

```{r}
## Pairwise T-Test for all metastisis data for each CIN metric
# OUTPUT: Dataframe that has the pairwise t-test results, including p-values.
# NOTE: The first column needed to renamed to match the respective CIN metric. 
## Creating an empty dataframe for the output to go into
test_meta <- data.frame(y = character(),
                        group1 = character(),
                        group2 = character(),
                        n1 = numeric(),
                        n2 = numeric(),
                        p = numeric(),
                        p.signif = character(),
                        p.adj = numeric(),
                        p.adj.signif = character())
## Performing the t-test for metastasis data for all CIN metrics
# NOTE: The first variable of the pairwise t-test must be numeric and the second variable must be a factor. Ensure that the dataframe of interest (in this case clinical_cin has the class of a dataframe only!
clinical_cin <- as.data.frame(clinical_cin)
cancers <- list("KIRC", "BRCA", "STAD","MESO", "READ", "KIRP", "PAAD", "CESC", "ESCA","KICH", "UVM", "SKCM", "COAD", "LUSC", "HNSC", "TGCT", "THCA", "LIHC", "BLCA", "CHOL","LUAD") # Omitted 11 cancers because of the lack of clinical data. The list of these cancers without clinical data can be found in the methods section of the CIN manuscript. ACC will be done separately because it uses a different column for its clinical data.
for(j in cancers){
    print(j)
    cancerdf <- subset(clinical_cin, Project == j) # Subsetting so the loop separates this master dataframe by cancer
    cancerdf <- cancerdf  %>% drop_na(ajcc_pathologic_m) # These are the samples that do not have metastasis data. I do this separately for each clinical variable because some samples only have one or two of the variables.
    cancerdf <- cancerdf[!(cancerdf$ajcc_pathologic_m == "MX"),] 
    print("finished data cleaning")
    
for (i in 4:9){
  cin <- cancerdf[, i] # These are the CIN metric values
  meta <- factor(cancerdf[,11], levels = c("M0", "M1")) # This is the metastasis data (M0 v. M1)
  df <- cbind(cin, meta)
  df <- as.data.frame(df)
  test_meta1 <-
    df %>%
    pairwise_t_test(
      cin ~ meta, paired = FALSE,
      p.adjust.method = "bonferroni"
    ) # performing t-test
  test_meta1$.y. <- i # putting cin metrics column number 
  test_meta1$project <- j # putting cancer names
  test_meta <- rbind(test_meta, test_meta1) 
  print("test_meta done")
}
}
## Pairwise T-Test for ACC metastasis data for each CIN metric
## NOTE: I am doing this cancer separately because it uses a different column (ajcc_clinical_m) and cannot be used in the loop. 
# OUTPUT: Dataframe that has the pairwise t-test results, including p-values.
## Creating an empty dataframe for the output to go into
acc_meta <- data.frame(y = character(),
                        group1 = character(),
                        group2 = character(),
                        n1 = numeric(),
                        n2 = numeric(),
                        p = numeric(),
                        p.signif = character(),
                        p.adj = numeric(),
                        p.adj.signif = character())
cancer <- list("ACC") # ACC does not use the same column. So I will repeat this analyses solely for ACC. 
for(j in cancer){
    print(j)
    cancerdf <- subset(clinical_cin, Project == j) # Subsetting so the loop separates this master dataframe by cancer
    cancerdf <- cancerdf  %>% drop_na(ajcc_clinical_m) # These are the samples that do not have metastasis data. I do this separately for each clinical variable because some samples only have one or two of the variables.
    cancerdf <- cancerdf[!(cancerdf$ajcc_clinical_m == "MX"),] 
    print("finished data cleaning")
    
for (i in 4:9){
  cin <- cancerdf[, i] # These are the CIN metric values
  meta <- factor(cancerdf[,10], levels = c("M0", "M1")) # This is the metastasis data from ajcc_clinical_m (M0 v. M1)
  df <- cbind(cin, meta)
  df <- as.data.frame(df)
  acc_meta1 <-
    df %>%
    pairwise_t_test(
      cin ~ meta, paired = FALSE,
      p.adjust.method = "bonferroni"
    ) 
  acc_meta1$.y. <- i
  acc_meta1$project <- j
  acc_meta <- rbind(acc_meta, acc_meta1) 
  print("test_meta done")
}
}
## Data cleaning
test_meta <- rbind(test_meta, acc_meta) %>% as.data.frame() # Combining the master dataframe with the p-values and the acc dataframe for metastisis data
colnames(test_meta)[1] <- "cin"
test_meta <- test_meta[, c(1, 10, 2:9)]
# Changing cin column values for cin to match name instead of column number
test_meta$cin <- ifelse(test_meta$cin %in% "4", "numBases.3", test_meta$cin)
test_meta$cin <- ifelse(test_meta$cin %in% "5", "numBreakPoints.3", test_meta$cin)
test_meta$cin <- ifelse(test_meta$cin %in% "6", "tai.3", test_meta$cin)
test_meta$cin <- ifelse(test_meta$cin %in% "7", "mod.tai.3", test_meta$cin)
test_meta$cin <- ifelse(test_meta$cin %in% "8", "fga.3", test_meta$cin)
test_meta$cin <- ifelse(test_meta$cin %in% "9", "cna.3", test_meta$cin)
# Changing group 1 and 2 to show the metastisis category instead of factor number
test_meta$group1 <- ifelse(test_meta$group1 %in% "1", "M0", test_meta$group1)
test_meta$group2 <- ifelse(test_meta$group2 %in% "2", "M1", test_meta$group2)
##### Save #####
save(test_meta, file = "/Volumes/G-DRIVEUSB/k99/clinical-corr/data/210713_clinical_analyses_testmeta_all.RData")
```



```{r}
## Pairwise T-Test for all node data for each CIN metric
# OUTPUT: Dataframe that has the pairwise t-test results, including p-values.
## Creating an empty dataframe for the output to go into
test_node <- data.frame(y = character(),
                        group1 = character(),
                        group2 = character(),
                        n1 = numeric(),
                        n2 = numeric(),
                        p = numeric(),
                        p.signif = character(),
                        p.adj = numeric(),
                        p.adj.signif = character())
## Performing the t-test for metastisis data for all CIN metrics
# NOTE: The first variable of the pairwise t-test must be numeric and the second variable must be a factor. Ensure that the dataframe of interest (in this case clinical_cin has the class of a dataframe only!
clinical_cin <- as.data.frame(clinical_cin)
cancers <- list("KIRC", "BRCA", "STAD","MESO", "READ", "KIRP", "PAAD", "CESC", "ESCA","KICH", "SKCM", "COAD", "LUSC", "HNSC", "TGCT", "THCA", "LIHC", "BLCA", "CHOL","LUAD", "ACC") # Omitted 12 cancers because of the lack of clinical data. The list of the 11 cancers without clinical data can be found in the methods section of the CIN manuscript. UVM was omitted because it only had N0 data
for(j in cancers){
    print(j)
    cancerdf <- subset(clinical_cin, Project == j) # Subsetting so the loop separates this master dataframe by cancer
    cancerdf <- cancerdf %>% drop_na(ajcc_pathologic_n) # These are the samples that do not have metastasis data. I do this separately for each clinical variable because some samples only have one or two of the variables.
    cancerdf <- cancerdf[!(cancerdf$ajcc_pathologic_n == "NX"), ] 
    print("finished data cleaning")
    
for (i in 4:9){
  cin <- cancerdf[, i] # These are the CIN metric values
  node <- factor(cancerdf[,12], levels = c("N0", "N1", "N2", "N3")) # This is the node data
  df <- cbind(cin, node)
  df <- as.data.frame(df)
  test_node1 <-
    df %>%
    pairwise_t_test(
      cin ~ node, paired = FALSE,
      p.adjust.method = "bonferroni"
    ) 
  test_node1$.y. <- i
  test_node1$project <- j
  test_node <- rbind(test_node, test_node1) 
  print("test_node done")
}
}
## Data cleaning
test_node <- as.data.frame(test_node)
colnames(test_node)[1] <- "cin"
test_node <- test_node[, c(1, 10, 2:9)]
# Changing cin column values for cin to match name instead of column number
test_node$cin <- ifelse(test_node$cin %in% "4", "numBases.3", test_node$cin)
test_node$cin <- ifelse(test_node$cin %in% "5", "numBreakPoints.3", test_node$cin)
test_node$cin <- ifelse(test_node$cin %in% "6", "tai.3", test_node$cin)
test_node$cin <- ifelse(test_node$cin %in% "7", "mod.tai.3", test_node$cin)
test_node$cin <- ifelse(test_node$cin %in% "8", "fga.3", test_node$cin)
test_node$cin <- ifelse(test_node$cin %in% "9", "cna.3", test_node$cin)
# Changing group 1 and 2 to show the node category instead of factor number
test_node$group1 <- ifelse(test_node$group1 %in% "1", "N0", test_node$group1)
test_node$group1 <- ifelse(test_node$group1 %in% "2", "N1", test_node$group1)
test_node$group1 <- ifelse(test_node$group1 %in% "3", "N2", test_node$group1)
test_node$group2 <- ifelse(test_node$group2 %in% "2", "N1", test_node$group2)
test_node$group2 <- ifelse(test_node$group2 %in% "3", "N2", test_node$group2)
test_node$group2 <- ifelse(test_node$group2 %in% "4", "N3", test_node$group2)
##### Save #####
save(test_node, file = "/Volumes/G-DRIVEUSB/k99/clinical-corr/data/210713_clinical_analyses_testnode_all.RData")
```

```{r}
## Pairwise T-Test for all stage data for each CIN metric
# OUTPUT: Dataframe that has the pairwise t-test results, including p-values.
# NOTE: The first column needed to renamed to match the respective CIN metric. 
## Creating an empty dataframe for the output to go into
test_stage <- data.frame(y = character(),
                        group1 = character(),
                        group2 = character(),
                        n1 = numeric(),
                        n2 = numeric(),
                        p = numeric(),
                        p.signif = character(),
                        p.adj = numeric(),
                        p.adj.signif = character())
## Performing the t-test for tumor stage data for all CIN metrics
# NOTE: The first variable of the pairwise t-test must be numeric and the second variable must be a factor. Ensure that the dataframe of interest (in this case clinical_cin has the class of a dataframe only!
clinical_cin <- as.data.frame(clinical_cin)
cancers <- list("KIRC", "BRCA", "STAD","MESO", "READ", "KIRP", "PAAD", "CESC", "ESCA","KICH", "SKCM", "COAD", "LUSC", "HNSC", "TGCT", "THCA", "LIHC", "BLCA", "CHOL","LUAD", "ACC", "UVM") # Omitted 11 cancers because of the lack of clinical data. The list of these cancers can be found in the methods section of the CIN manuscript. 
for(j in cancers){
    print(j)
    cancerdf <- subset(clinical_cin, Project == j) # Subsetting so the loop separates this master dataframe by cancer
    cancerdf <- cancerdf %>% drop_na(ajcc_pathologic_t) # These are the samples that do not have metastasis data. I do this separately for each clinical variable because some samples only have one or two of the variables.
    cancerdf <- cancerdf[!(cancerdf$ajcc_pathologic_n == c("TX", "Tis")), ] # Removing Tis because it was not included in the PI paper analyses
    print("finished data cleaning")
    
for (i in 4:9){
  cin <- cancerdf[, i] # These are the CIN metric values
  stage <- factor(cancerdf[,13], levels = c("T0", "T1", "T2", "T3", "T4")) # This is the stage data
  df <- cbind(cin, stage)
  df <- as.data.frame(df)
  test_stage1 <-
    df %>%
    pairwise_t_test(
      cin ~ stage, paired = FALSE,
      p.adjust.method = "bonferroni"
    ) 
  test_stage1$.y. <- i
  test_stage1$project <- j
  test_stage <- rbind(test_stage, test_stage1) 
  print("test_stage done")
}
}
## Data cleaning
test_stage <- as.data.frame(test_stage)
colnames(test_stage)[1] <- "cin"
test_stage <- test_stage[, c(1, 10, 2:9)]
# Changing cin column values for cin to match name instead of column number 
test_stage$cin <- ifelse(test_stage$cin %in% "4", "numBases.3", test_stage$cin)
test_stage$cin <- ifelse(test_stage$cin %in% "5", "numBreakPoints.3", test_stage$cin)
test_stage$cin <- ifelse(test_stage$cin %in% "6", "tai.3", test_stage$cin)
test_stage$cin <- ifelse(test_stage$cin %in% "7", "mod.tai.3", test_stage$cin)
test_stage$cin <- ifelse(test_stage$cin %in% "8", "fga.3", test_stage$cin)
test_stage$cin <- ifelse(test_stage$cin %in% "9", "cna.3", test_stage$cin)
# Changing group 1 and 2 to show the node category instead of factor number
test_stage$group1 <- ifelse(test_stage$group1 %in% "1", "T0", test_stage$group1)
test_stage$group1 <- ifelse(test_stage$group1 %in% "2", "T1", test_stage$group1)
test_stage$group1 <- ifelse(test_stage$group1 %in% "3", "T2", test_stage$group1)
test_stage$group1 <- ifelse(test_stage$group1 %in% "4", "T3", test_stage$group1)
test_stage$group2 <- ifelse(test_stage$group2 %in% "2", "T1", test_stage$group2)
test_stage$group2 <- ifelse(test_stage$group2 %in% "3", "T2", test_stage$group2)
test_stage$group2 <- ifelse(test_stage$group2 %in% "4", "T3", test_stage$group2)
test_stage$group2 <- ifelse(test_stage$group2 %in% "5", "T4", test_stage$group2)
##### Save #####
save(test_stage, file = "/Volumes/G-DRIVEUSB/k99/clinical-corr/data/210713_clinical_analyses_teststage_all.RData")
```


-------------------------------------------------------------------

# CINmetrics with Clinical Variables
```{r}
library(tidyverse)
library(here)
library(rstatix)
library(devtools)
library(ggpubr)
library(dplyr)
```
## CINmetrics with Clinical Variables Dataframe
```{r}
## Loading the data with all of the CINmetrics values
all.cinmetrics.df <- read.csv('~/Desktop/CINmetrics_Cancer_Analysis/data/processed/all_cinmetrics_df.csv')
## This function takes the dataframe with the CINmetrics values and the CNV data and creates a dataframe that will also have the clinical variables associated by Patient ID
get_tnm <- function(all.cancer.df, all.cinmetrics.df){
  # Joining clinical variables to the CINmetrics dataframe and filtering out the cancers without TNM data
  all.tnm.df <- inner_join(all.cinmetrics.df, all.cancer.df[,c(7,13:16)], by = c("sample_id" = "Sample")) %>% unique(.) %>% filter(!project %in% c("TCGA-GBM", "TCGA-LAML", "TCGA-OV", "TCGA-THYM", "TCGA-UCS", "TCGA-DLBC", "TCGA-PCPG", "TCGA-UCEC", "TCGA-SARC", "TCGA-PRAD", "TCGA-LGG")) 
  # We store the output as a csv
write.csv(all.tnm.df, file = here("data", "processed", "all_tnm_df.csv"), row.names = FALSE)
  return(all.tnm.df)
}
all.tnm.df <- get_tnm(all.cancer.df, all.cinmetrics.df)
```
## U-tests for CINmetrics and TNM Stages
```{r}
## We create vectors with the 22 cancer names and 6 CINmetrics to loop through 
cancer.project <- c("TCGA-KIRC", "TCGA-BRCA", "TCGA-MESO", "TCGA-READ", "TCGA-KIRP", "TCGA-PAAD", "TCGA-ACC", "TCGA-CESC", "TCGA-ESCA", "TCGA-KICH", "TCGA-UVM", "TCGA-SKCM", "TCGA-COAD", "TCGA-LUSC", "TCGA-HNSC", "TCGA-TGCT", "TCGA-THCA", "TCGA-LIHC", "TCGA-BLCA", "TCGA-CHOL", "TCGA-STAD", "TCGA-LUAD")
metrics <- c("tai", "modified_tai", "cna","base_segments", "break_points", "fga")
## This function takes the all.tnm.df and performs a Mann-Whitney U-test on each of the stages depending on TNM for tumor samples
get_utest_data <- function(all.tnm.df, cancer.project, tnm.category, metrics){
  if(tnm.category == "tumor.stage"){
    # We create an empty dataframe to store the U-test data
    tumor.stage.utest.df <- data.frame(.y. = character(),
                        group1 = character(),
                        group2 = character(),
                        n1 = numeric(),
                        n2 = numeric(),
                        p = numeric(),
                        p.signif = character(),
                        p.adj = numeric(),
                        p.adj.signif = character())
    
    for(i in 1:length(cancer.project)){
    tumor.stage.df <- subset(all.tnm.df, project == cancer.project[i])
    
    # We filter  the dataframe to only have the tumor stages and tumor samples we want included in the analysis
    tumor.stage.df <- tumor.stage.df %>% select(!c(ajcc_pathologic_m, ajcc_pathologic_n, ajcc_clinical_m)) %>% filter(!(ajcc_pathologic_t %in% c("TX", "Tis", "T0")) & sample_type %in% c("Metastatic", "Primary Blood Derived Cancer", "Primary Tumor", "Recurrent Tumor", "Additional - New Primary", "Primary Blood Derived Cancer - Peripheral Blood")) %>% drop_na(ajcc_pathologic_t)
    tumor.stage.df$ajcc_pathologic_t <- ifelse(tumor.stage.df$ajcc_pathologic_t %in% c("T1a", "T1a1", "T1b", "T1b2", "T1b1", "T1c"), "T1", ifelse(tumor.stage.df$ajcc_pathologic_t %in% c("T2a", "T2b", "T2c", "T2a2", "T2a1", "T2a2"), "T2", ifelse(tumor.stage.df$ajcc_pathologic_t %in% c("T3a", "T3b", "T3c"), "T3", ifelse(tumor.stage.df$ajcc_pathologic_t %in% c("T4a", "T4b", "T4c", "T4d", "T4e"), "T4", tumor.stage.df$ajcc_pathologic_t))))
    
    for(j in metrics){
    # We performed the Mann-Whitney U-test (otherwise known as the Wilcoxon test)
    cinmetrics <- tumor.stage.df[, j]
    tumor_stage <- factor(tumor.stage.df[,"ajcc_pathologic_t"], levels = c("T1", "T2", "T3", "T4"))
    cinmetrics.stage.df <- cbind(cinmetrics, tumor_stage) %>% as.data.frame(.)
    utest.results <- cinmetrics.stage.df %>% wilcox_test(cinmetrics ~ tumor_stage, paired = FALSE, p.adjust.method = "bonferroni")
    utest.results$project <- cancer.project[i]
    utest.results$cin <- j
    tumor.stage.utest.df <- rbind(tumor.stage.utest.df, utest.results)
    }
    }
    
    # We changed the group names in the U-test results to match the tumor stage
    tumor.stage.utest.df <- tumor.stage.utest.df %>% select(cin, project, group1, group2, n1, n2, statistic, p, p.adj, p.adj.signif)
    tumor.stage.utest.df$group1 <- ifelse(tumor.stage.utest.df$group1 %in% "1", "T1", ifelse(tumor.stage.utest.df$group1 %in% "2", "T2", ifelse(tumor.stage.utest.df$group1 %in% "3", "T3", ifelse(tumor.stage.utest.df$group1 %in% "4", "T4", tumor.stage.utest.df$group1))))
    tumor.stage.utest.df$group2 <- ifelse(tumor.stage.utest.df$group2 %in% "1", "T1", ifelse(tumor.stage.utest.df$group2 %in% "2", "T2", ifelse(tumor.stage.utest.df$group2 %in% "3", "T3", ifelse(tumor.stage.utest.df$group2 %in% "4", "T4", tumor.stage.utest.df$group2))))
    
    # We will store this output in a CSV file 
    write.csv(tumor.stage.utest.df, file = here("data", "processed", "tumor_stage_utest_df.csv"), row.names = FALSE)
    return(tumor.stage.utest.df)
    
  } 
  if(tnm.category == "metastasis"){
    # We create empty data frames to store the U-test data
    metastasis.utest.df <- data.frame(.y. = character(),
                        group1 = character(),
                        group2 = character(),
                        n1 = numeric(),
                        n2 = numeric(),
                        p = numeric(),
                        project = character(), 
                        cin = character())
    acc.metastasis.utest.df <- data.frame(.y. = character(),
                        group1 = character(),
                        group2 = character(),
                        n1 = numeric(),
                        n2 = numeric(),
                        p = numeric(),
                        project = character(), 
                        cin = character())
    
    for(i in 1:length(cancer.project)){
    if(cancer.project[i] != "TCGA-ACC"){
    # We separated the analyses for metastasis data to be dependent on the column it uses
    metastasis.df <- subset(all.tnm.df, project == cancer.project[i])
    
    # We filter the data frame to only have the metastasis data we want included in the analysis
    metastasis.df <- metastasis.df %>% select(!c(ajcc_pathologic_t, ajcc_pathologic_n, ajcc_clinical_m)) %>% filter(!(ajcc_pathologic_m %in% "MX") & sample_type %in% c("Metastatic", "Primary Blood Derived Cancer", "Primary Tumor", "Recurrent Tumor", "Additional - New Primary", "Primary Blood Derived Cancer - Peripheral Blood")) %>% drop_na()
    metastasis.df$ajcc_pathologic_m <- ifelse(metastasis.df$ajcc_pathologic_m %in% c("cM0 (i+)"), "M0", ifelse(metastasis.df$ajcc_pathologic_m %in% c("M1a", "M1b", "M1c"), "M1", metastasis.df$ajcc_pathologic_m))
    
    for(j in metrics){
    # We performed the Mann-Whitney U-test (otherwise known as the Wilcoxon test)
    cinmetrics <- metastasis.df[, j]
    metastasis <- factor(metastasis.df[,"ajcc_pathologic_m"], levels = c("M0", "M1"))
    cinmetrics.metastasis.df <- cbind(cinmetrics, metastasis) %>% as.data.frame(.)
    utest.results <- 
      cinmetrics.metastasis.df %>% wilcox_test(cinmetrics ~ metastasis, p.adjust.method = "none")
  
    utest.results$project <- cancer.project[i]
    utest.results$cin <- j
    metastasis.utest.df <- rbind(metastasis.utest.df, utest.results)
    }
    }
     else{
    acc.metastasis.df <- subset(all.tnm.df, project == cancer.project[i])
    # We filter the data frame to only have the metastasis data we want included in the analysis
    acc.metastasis.df <- acc.metastasis.df %>% select(!c(ajcc_pathologic_t, ajcc_pathologic_n, ajcc_pathologic_m)) %>% filter(!(ajcc_clinical_m %in% "MX") & sample_type %in% c("Metastatic", "Primary Blood Derived Cancer", "Primary Tumor", "Recurrent Tumor", "Additional - New Primary", "Primary Blood Derived Cancer - Peripheral Blood")) %>% drop_na()
    acc.metastasis.df$ajcc_clinical_m <- ifelse(acc.metastasis.df$ajcc_clinical_m %in% c("cM0 (i+)"), "M0", ifelse(acc.metastasis.df$ajcc_clinical_m %in% c("M1a", "M1b", "M1c"), "M1", acc.metastasis.df$ajcc_clinical_m))
    
    for(j in metrics){
    # We performed the Mann-Whitney U-test (otherwise known as the Wilcoxon test)
    acc.cinmetrics <- acc.metastasis.df[, j]
   acc.metastasis <- factor(acc.metastasis.df[,"ajcc_clinical_m"], levels = c("M0", "M1"))
    acc.cinmetrics.metastasis.df <- cbind(acc.cinmetrics, acc.metastasis) %>% as.data.frame(.)
    acc.utest.results <- 
      acc.cinmetrics.metastasis.df %>% wilcox_test(acc.cinmetrics ~ acc.metastasis, p.adjust.method = "none")
    acc.utest.results$project <- cancer.project[i]
    acc.utest.results$cin <- j
    acc.metastasis.utest.df <- rbind(acc.metastasis.utest.df, acc.utest.results)
    }
     }
    }
    # We changed the group names in the U-test results to match the metastasis categories
    metastasis.utest.df <- metastasis.utest.df %>% select(cin, project, group1, group2, n1, n2, statistic, p)
   metastasis.utest.df$group1 <- ifelse(metastasis.utest.df$group1 %in% "1", "M0", ifelse(metastasis.utest.df$group1 %in% "2", "M1", metastasis.utest.df$group1))
   metastasis.utest.df$group2 <- ifelse(metastasis.utest.df$group2 %in% "1", "M0", ifelse(metastasis.utest.df$group2 %in% "2", "M1", metastasis.utest.df$group1))
   
   acc.metastasis.utest.df <- acc.metastasis.utest.df %>% select(cin, project, group1, group2, n1, n2, statistic, p)
   acc.metastasis.utest.df$group1 <- ifelse(acc.metastasis.utest.df$group1 %in% "1", "M0", ifelse(acc.metastasis.utest.df$group1 %in% "2", "M1", acc.metastasis.utest.df$group1))
   acc.metastasis.utest.df$group2 <- ifelse(acc.metastasis.utest.df$group2 %in% "1", "M0", ifelse(acc.metastasis.utest.df$group2 %in% "2", "M1", acc.metastasis.utest.df$group1))
   metastasis.utest.df <- rbind(metastasis.utest.df, acc.metastasis.utest.df)
   
   # We will store this output in a CSV file 
   write.csv(metastasis.utest.df, file = here("data", "processed", "metastasis_utest_df.csv"), row.names = FALSE)
   return(metastasis.utest.df)
  }  
  if(tnm.category == "node"){
    # We created empty data frames to store the U-test data
    node.utest.df <- data.frame(.y. = character(),
                        group1 = character(),
                        group2 = character(),
                        n1 = numeric(),
                        n2 = numeric(),
                        statistic = numeric(),
                        p = numeric(),
                        project = character(), 
                        cin = character())
    node.adjusted.utest <- data.frame(.y. = character(),
                        group1 = character(),
                        group2 = character(),
                        n1 = numeric(),
                        n2 = numeric(),
                        p = numeric(),
                        p.signif = character(),
                        p.adj = numeric(),
                        p.adj.signif = character(),
                        project = character(),
                        cin = character())
    
    for(i in 1:length(cancer.project)){
    # We separated the analyses for node data to be dependent on the number of lymph node inclusion categories there are
      
    if(cancer.project[i] == "TCGA-ACC" || cancer.project[i] == "TCGA-CESC" || cancer.project[i] == "TCGA-CHOL" || cancer.project[i] == "TCGA-KIRC" || cancer.project[i] == "TCGA-LIHC" || cancer.project[i] == "TCGA-PAAD" || cancer.project[i] == "TCGA-THCA"){
    node.df <- subset(all.tnm.df, project == cancer.project[i])
    
    # We filtered the data frame to only have the node data we want included in the analysis
    node.df <- node.df %>% select(!c(ajcc_pathologic_t, ajcc_pathologic_m, ajcc_clinical_m)) %>% filter(!(ajcc_pathologic_n %in% "NX") & sample_type %in% c("Metastatic", "Primary Blood Derived Cancer", "Primary Tumor", "Recurrent Tumor", "Additional - New Primary", "Primary Blood Derived Cancer - Peripheral Blood")) %>% drop_na()
  
    node.df$ajcc_pathologic_n <- ifelse(node.df$ajcc_pathologic_n %in% c("N0 (i+)", "N0 (i-)", "N0 (mol+)"), "N0", ifelse(node.df$ajcc_pathologic_n %in% c("N1mi", "N1a", "N1b", "N1c"), "N1", ifelse(node.df$ajcc_pathologic_n %in% c("N2a", "N2b", "N2c"), "N2", ifelse(node.df$ajcc_pathologic_n %in% c("N3a", "N3b", "N3c"), "N3", node.df$ajcc_pathologic_n))))
    for(j in metrics){
    # We performed the Mann-Whitney U-test (otherwise known as the Wilcoxon test)
    cinmetrics <- node.df[, j]
    node <- factor(node.df[,"ajcc_pathologic_n"], levels = c("N0", "N1"))
    cinmetrics.node.df <- cbind(cinmetrics, node) %>% as.data.frame(.)
    utest.results <- 
      cinmetrics.node.df %>% wilcox_test(cinmetrics ~ node, p.adjust.method = "none")
    utest.results$project <- cancer.project[i]
    utest.results$cin <- j
    node.utest.df <- rbind(node.utest.df, utest.results)
    }
    }
      if(cancer.project[i] == "TCGA-COAD" || cancer.project[i] == "TCGA-KICH" || cancer.project[i] == "TCGA-KIRP" || cancer.project[i] == "TCGA-READ" || cancer.project[i] == "TCGA-TGCT" || cancer.project[i] == "TCGA-BLCA" || cancer.project[i] == "TCGA-BRCA" || cancer.project[i] == "TCGA-ESCA" || cancer.project[i] == "TCGA-HNSC" || cancer.project[i] == "TCGA-LUAD" || cancer.project[i] == "TCGA-LUSC" || cancer.project[i] == "TCGA-MESO" || cancer.project[i] == "TCGA-STAD" || cancer.project[i] == "TCGA-SKCM"){
        
    node.df <- subset(all.tnm.df, project == cancer.project[i])
    
    # we filtered the data frame to only have the node data we want included in the analysis
    node.df <- node.df %>% select(!c(ajcc_pathologic_t, ajcc_pathologic_m, ajcc_clinical_m)) %>% filter(!(ajcc_pathologic_n %in% "NX") & sample_type %in% c("Metastatic", "Primary Blood Derived Cancer", "Primary Tumor", "Recurrent Tumor", "Additional - New Primary", "Primary Blood Derived Cancer - Peripheral Blood")) %>% drop_na()
  
    node.df$ajcc_pathologic_n <- ifelse(node.df$ajcc_pathologic_n %in% c("N0 (i+)", "N0 (i-)", "N0 (mol+)"), "N0", ifelse(node.df$ajcc_pathologic_n %in% c("N1mi", "N1a", "N1b", "N1c"), "N1", ifelse(node.df$ajcc_pathologic_n %in% c("N2a", "N2b", "N2c"), "N2", ifelse(node.df$ajcc_pathologic_n %in% c("N3a", "N3b", "N3c"), "N3", node.df$ajcc_pathologic_n))))
    for(j in metrics){
    # We performed the Mann-Whitney U-test (otherwise known as the Wilcoxon test)
    cinmetrics <- node.df[, j]
    node <- factor(node.df[,"ajcc_pathologic_n"], levels = c("N0", "N1", "N2", "N3"))
    cinmetrics.node.df <- cbind(cinmetrics, node) %>% as.data.frame(.)
    utest.results <- 
      cinmetrics.node.df %>% 
      wilcox_test(cinmetrics ~ node, paired = FALSE, p.adjust.method = "bonferroni")
    utest.results$project <- cancer.project[i]
    utest.results$cin <- j
    node.adjusted.utest <- rbind(node.adjusted.utest, utest.results)
    }
      } 
      else{
    # Skipping over the cancers that does not have enough node data for U-tests (like TCGA-UVM)
        next
      }
    }
    # We combined both of the node U-test data frames
    node.utest.df <- node.utest.df %>% add_column(p.adj = NA) %>% add_column(p.adj.signif = NA) %>% select(cin, project, group1, group2, n1, n2, statistic, p, p.adj, p.adj.signif)
    node.adjusted.utest <- node.adjusted.utest %>% select(cin, project, group1, group2, n1, n2, statistic, p, p.adj, p.adj.signif)
    node.utest.df <- rbind(node.utest.df, node.adjusted.utest) %>% as.data.frame()
    
    # We changed the group names in the U-test results to match the node categories
   node.utest.df$group1 <- ifelse(node.utest.df$group1 %in% "1", "N0", ifelse(node.utest.df$group1 %in% "2", "N1", ifelse(node.utest.df$group1 %in% "3", "N2", node.utest.df$group1)))
   node.utest.df$group2 <- ifelse(node.utest.df$group2 %in% "2", "N1", ifelse(node.utest.df$group2 %in% "3", "N2", ifelse(node.utest.df$group2 %in% "4", "N3", node.utest.df$group1)))
   
   # We will store this output in a CSV file 
   write.csv(node.utest.df, file = here("data", "processed", "node_utest_df.csv"), row.names = FALSE)
   return(node.utest.df)
  }
  else{
    stop("Incorrect input for tnm.category. Make sure you pick 'tumor.stage', 'metastasis', or 'node'")
  }
  }
tumor.stage.utest.df <- get_utest_data(all.tnm.df, cancer.project, tnm.category = "tumor.stage", metrics)
metastasis.utest.df <- get_utest_data(all.tnm.df, cancer.project, tnm.category = "metastasis", metrics)
node.utest.df <- get_utest_data(all.tnm.df, cancer.project, tnm.category = "node", metrics)
```


```{r}
# Loading data for Wilcox bar graphs
metastasis.utest.df <- read_csv("~/Desktop/CINmetrics_Cancer_Analysis/data/processed/metastasis_utest_df.csv")
node.utest.df <- read_csv("~/Desktop/CINmetrics_Cancer_Analysis/data/processed/node_utest_df.csv")
tumor.stage.utest.df <- read_csv("~/Desktop/CINmetrics_Cancer_Analysis/data/processed/tumor_stage_utest_df.csv")
# This function takes the dataframe with the p.adj and p.values from the U-test results and creates bar graphs to compare across cancers. 
get_utest_graphs <- function(tnm.category, cancer.project){
  if(tnm.category == "tumor.stage"){
    # Filter for T1 and T4 and -Log10 transformation of p values
    filtered.tumor.stage.utest <- filter(tumor.stage.utest.df, group1 == "T1" & group2 == "T4")
    filtered.tumor.stage.df<- filtered.tumor.stage.utest %>% select(cin, project, group1, group2)
    # Creating a function to input into sapply
    neglog10 <- function(x){
      neglog10 <- -log10(x)
      return(neglog10)
    }
    log.tumor.stage.utest <- filtered.tumor.stage.utest %>% select(p) %>% sapply(., neglog10)
    log.tumor.stage.utest <- cbind(filtered.tumor.stage.df, log.tumor.stage.utest)
    log.tumor.stage.utest$project <- str_remove(log.tumor.stage.utest$project, "TCGA-")
    
    # Base Segments Plot
    base.segments.utest <- filter(log.tumor.stage.utest, cin == "base_segments")
    base.segments.barplot <- ggbarplot(base.segments.utest,
                                       x = "project", y = "p",
                                       rotate = TRUE,
                                       xlab = "Cancer",
                                       ylab = "-Log10 p-value (T4 v. T1)",
                                       width = 0.4,
                                       sort.val = "asc",
                                       fill = "black",
                                       title = " ",
                                       font.main = c(11, "bold"),
                                       font.x = c(10, "bold"),
                                       font.y = c(10, "bold"),
                                       font.xtickslab = c(10, "bold"),
                                      font.ytickslab = c(4, "bold"),) + geom_hline(yintercept = 1.30103, linetype = "dashed", color = "red") 
    # Breakpoints Plot
    break.points.utest <- filter(log.tumor.stage.utest, cin == "break_points")
    break.points.barplot <- ggbarplot(break.points.utest,
                                       x = "project", y = "p",
                                       rotate = TRUE,
                                       xlab = "Cancer",
                                       ylab = "-Log10 p-value (T4 v. T1)",
                                       width = 0.4,
                                       sort.val = "asc",
                                       fill = "black",
                                       title = " ",
                                       font.main = c(11, "bold"),
                                       font.x = c(10, "bold"),
                                       font.y = c(10, "bold"),
                                       font.xtickslab = c(10, "bold"),
                                      font.ytickslab = c(4, "bold"),) + geom_hline(yintercept = 1.30103, linetype = "dashed", color = "red")
    # TAI bar plot
    tai.utest <- filter(log.tumor.stage.utest, cin == "tai")
    tai.barplot <- ggbarplot(tai.utest,
                                       x = "project", y = "p",
                                       rotate = TRUE,
                                       xlab = "Cancer",
                                       ylab = "-Log10 p-value (T4 v. T1)",
                                       width = 0.4,
                                       sort.val = "asc",
                                       fill = "black",
                                       title = " ",
                                       font.main = c(11, "bold"),
                                       font.x = c(10, "bold"),
                                       font.y = c(10, "bold"),
                                       font.xtickslab = c(10, "bold"),
                                      font.ytickslab = c(4, "bold"),) + geom_hline(yintercept = 1.30103, linetype = "dashed", color = "red")
    # FGA bar plot
    fga.utest <- filter(log.tumor.stage.utest, cin == "fga")
    fga.barplot <- ggbarplot(fga.utest,
                                       x = "project", y = "p",
                                       rotate = TRUE,
                                       xlab = "Cancer",
                                       ylab = "-Log10 p-value (T4 v. T1)",
                                       width = 0.4,
                                       sort.val = "asc",
                                       fill = "black",
                                       title = " ",
                                       font.main = c(11, "bold"),
                                       font.x = c(10, "bold"),
                                       font.y = c(10, "bold"),
                                       font.xtickslab = c(10, "bold"),
                                      font.ytickslab = c(4, "bold"),) + geom_hline(yintercept = 1.30103, linetype = "dashed", color = "red")
    # CNA bar plot
    cna.utest <- filter(log.tumor.stage.utest, cin == "cna")
    cna.barplot <- ggbarplot(cna.utest,
                                       x = "project", y = "p",
                                       rotate = TRUE,
                                       xlab = "Cancer",
                                       ylab = "-Log10 p-value (T4 v. T1)",
                                       width = 0.4,
                                       sort.val = "asc",
                                       fill = "black",
                                       title = " ",
                                       font.main = c(11, "bold"),
                                       font.x = c(10, "bold"),
                                       font.y = c(10, "bold"),
                                       font.xtickslab = c(10, "bold"),
                                      font.ytickslab = c(4, "bold"),) + geom_hline(yintercept = 1.30103, linetype = "dashed", color = "red")
   
     # Modified TAI bar plot
    modified.tai.utest <- filter(log.tumor.stage.utest, cin == "modified_tai")
    modified.tai.barplot <- ggbarplot(modified.tai.utest,
                                       x = "project", y = "p",
                                       rotate = TRUE,
                                       xlab = "Cancer",
                                       ylab = "-Log10 p-value (T4 v. T1)",
                                       width = 0.4,
                                       sort.val = "asc",
                                       fill = "black",
                                       title = " ",
                                       font.main = c(11, "bold"),
                                       font.x = c(10, "bold"),
                                       font.y = c(10, "bold"),
                                       font.xtickslab = c(10, "bold"),
                                      font.ytickslab = c(4, "bold"),) + geom_hline(yintercept = 1.30103, linetype = "dashed", color = "red")
    
    # Tumor Stage Bar Plot
    tumor.stage.barplot <- ggarrange(base.segments.barplot + rremove("xlab"),
                                     break.points.barplot + rremove("xlab"),
                                     tai.barplot + rremove("xlab"),
                                     fga.barplot + rremove("xlab"),
                                     cna.barplot + rremove("xlab"),
                                     modified.tai.barplot + rremove("xlab"),
                                     ncol = 1, nrow = 6)
    tumor.stage.barplot <- annotate_figure(tumor.stage.barplot, 
                    bottom = text_grob("-Log10 p-value (T4 v. T1)"))
    return(tumor.stage.barplot)
                                  
  }
  
  if(tnm.category == "metastasis"){
    # Filter for T1 and T4 and -Log10 transformation of p values
    filtered.metastasis.utest <- filter(metastasis.utest.df, group1 == "M0" & group2 == "M1")
    filtered.metastasis.df<- filtered.metastasis.utest %>% select(cin, project, group1, group2)
    # Creating a function to input into sapply
    neglog10 <- function(x){
      neglog10 <- -log10(x)
      return(neglog10)
    }
    log.metastasis.utest <- filtered.metastasis.utest %>% select(p) %>% sapply(., neglog10)
    log.metastasis.utest <- cbind(filtered.metastasis.df, log.metastasis.utest)
    log.metastasis.utest$project <- str_remove(log.metastasis.utest$project, "TCGA-")
    
    # Base Segments Plot
    base.segments.utest <- filter(log.metastasis.utest, cin == "base_segments")
    base.segments.barplot <- ggbarplot(base.segments.utest,
                                       x = "project", y = "p",
                                       rotate = TRUE,
                                       xlab = "Cancer",
                                       ylab = "-Log10 p-value (M1 v. M0)",
                                       width = 0.4,
                                       sort.val = "asc",
                                       fill = "black",
                                       title = "Base Segments",
                                       font.main = c(11, "bold"),
                                       font.x = c(10, "bold"),
                                       font.y = c(10, "bold"),
                                       font.xtickslab = c(10, "bold"),
                                      font.ytickslab = c(4, "bold"),) + geom_hline(yintercept = 1.30103, linetype = "dashed", color = "red") + theme(plot.title = element_text(hjust = 0.5))
    # Breakpoints Plot
    break.points.utest <- filter(log.metastasis.utest, cin == "break_points")
    break.points.barplot <- ggbarplot(break.points.utest,
                                       x = "project", y = "p",
                                       rotate = TRUE,
                                       xlab = "Cancer",
                                       ylab = "-Log10 p-value (M1 v. M0)",
                                       width = 0.4,
                                       sort.val = "asc",
                                       fill = "black",
                                       title = "Break Points",
                                       font.main = c(11, "bold"),
                                       font.x = c(10, "bold"),
                                       font.y = c(10, "bold"),
                                       font.xtickslab = c(10, "bold"),
                                      font.ytickslab = c(4, "bold"),) + geom_hline(yintercept = 1.30103, linetype = "dashed", color = "red") + theme(plot.title = element_text(hjust = 0.5))
    # TAI bar plot
    tai.utest <- filter(log.metastasis.utest, cin == "tai")
    tai.barplot <- ggbarplot(tai.utest,
                                       x = "project", y = "p",
                                       rotate = TRUE,
                                       xlab = "Cancer",
                                       ylab = "-Log10 p-value (M1 v. M0)",
                                       width = 0.4,
                                       sort.val = "asc",
                                       fill = "black",
                                       title = "TAI",
                                       font.main = c(11, "bold"),
                                       font.x = c(10, "bold"),
                                       font.y = c(10, "bold"),
                                       font.xtickslab = c(10, "bold"),
                                      font.ytickslab = c(4, "bold"),) + geom_hline(yintercept = 1.30103, linetype = "dashed", color = "red") + theme(plot.title = element_text(hjust = 0.5))
    # FGA bar plot
    fga.utest <- filter(log.metastasis.utest, cin == "fga")
    fga.barplot <- ggbarplot(fga.utest,
                                       x = "project", y = "p",
                                       rotate = TRUE,
                                       xlab = "Cancer",
                                       ylab = "-Log10 p-value (M1 v. M0)",
                                       width = 0.4,
                                       sort.val = "asc",
                                       fill = "black",
                                       title = "FGA",
                                       font.main = c(11, "bold"),
                                       font.x = c(10, "bold"),
                                       font.y = c(10, "bold"),
                                       font.xtickslab = c(10, "bold"),
                                      font.ytickslab = c(4, "bold"),) + geom_hline(yintercept = 1.30103, linetype = "dashed", color = "red") + theme(plot.title = element_text(hjust = 0.5))
    # CNA bar plot
    cna.utest <- filter(log.metastasis.utest, cin == "cna")
    cna.barplot <- ggbarplot(cna.utest,
                                       x = "project", y = "p",
                                       rotate = TRUE,
                                       xlab = "Cancer",
                                       ylab = "-Log10 p-value (M1 v. M0)",
                                       width = 0.4,
                                       sort.val = "asc",
                                       fill = "black",
                                       title = "CNA",
                                       font.main = c(11, "bold"),
                                       font.x = c(10, "bold"),
                                       font.y = c(10, "bold"),
                                       font.xtickslab = c(10, "bold"),
                                      font.ytickslab = c(4, "bold"),) + geom_hline(yintercept = 1.30103, linetype = "dashed", color = "red") + theme(plot.title = element_text(hjust = 0.5))
   
     # Modified TAI bar plot
    modified.tai.utest <- filter(log.metastasis.utest, cin == "modified_tai")
    modified.tai.barplot <- ggbarplot(modified.tai.utest,
                                       x = "project", y = "p",
                                       rotate = TRUE,
                                       xlab = "Cancer",
                                       ylab = "-Log10 p-value (M1 v. M0)",
                                       width = 0.4,
                                       sort.val = "asc",
                                       fill = "black",
                                       title = "Modified TAI",
                                       font.main = c(11, "bold"),
                                       font.x = c(10, "bold"),
                                       font.y = c(10, "bold"),
                                       font.xtickslab = c(10, "bold"),
                                      font.ytickslab = c(4, "bold"),) + geom_hline(yintercept = 1.30103, linetype = "dashed", color = "red") + theme(plot.title = element_text(hjust = 0.5))
    
    # Tumor Stage Bar Plot
    metastasis.barplot <- ggarrange(base.segments.barplot + rremove("xlab"),
                                     break.points.barplot + rremove("xlab"),
                                     tai.barplot + rremove("xlab"),
                                     fga.barplot + rremove("xlab"),
                                     cna.barplot + rremove("xlab"),
                                     modified.tai.barplot + rremove("xlab"),
                                     ncol = 1, nrow = 6)
   metastasis.barplot <- annotate_figure(metastasis.barplot, 
                    bottom = text_grob("-Log10 p-value (M1 v. M0)"))
    return(metastasis.barplot)
  }
  if(tnm.category == "node"){
    filtered.node.utest <- dplyr::filter(node.utest.df, group1 == "N0" & group2 == "N1")
    filtered.node.df <- filtered.node.utest %>% select(cin, project, group1, group2)
    # Creating a function to input into sapply
    neglog10 <- function(x){
      neglog10 <- -log10(x)
      return(neglog10)
    }
    log.node.utest <- filtered.node.utest %>% select(p) %>% sapply(., neglog10)
    log.node.utest <- cbind(filtered.node.df, log.node.utest)
    log.node.utest$project <- str_remove(log.node.utest$project, "TCGA-")
    
    # Base Segments Plot
    base.segments.utest <- filter(log.node.utest, cin == "base_segments")
    base.segments.barplot <- ggbarplot(base.segments.utest,
                                       x = "project", y = "p",
                                       rotate = TRUE,
                                       xlab = "Cancer",
                                       ylab = "-Log10 p-value (N1 v. N0)",
                                       width = 0.4,
                                       sort.val = "asc",
                                       fill = "black",
                                       title = " ",
                                       font.main = c(11, "bold"),
                                       font.x = c(10, "bold"),
                                       font.y = c(10, "bold"),
                                       font.xtickslab = c(10, "bold"),
                                      font.ytickslab = c(4, "bold"),) + geom_hline(yintercept = 1.30103, linetype = "dashed", color = "red")
    # Breakpoints Plot
    break.points.utest <- filter(log.node.utest, cin == "break_points")
    break.points.barplot <- ggbarplot(break.points.utest,
                                       x = "project", y = "p",
                                       rotate = TRUE,
                                       xlab = "Cancer",
                                       ylab = "-Log10 p-value (N1 v. N0)",
                                       width = 0.4,
                                       sort.val = "asc",
                                       fill = "black",
                                       title = " ",
                                       font.main = c(11, "bold"),
                                       font.x = c(10, "bold"),
                                       font.y = c(10, "bold"),
                                       font.xtickslab = c(10, "bold"),
                                      font.ytickslab = c(4, "bold"),) + geom_hline(yintercept = 1.30103, linetype = "dashed", color = "red")
    # TAI bar plot
    tai.utest <- filter(log.node.utest, cin == "tai")
    tai.barplot <- ggbarplot(tai.utest,
                                       x = "project", y = "p",
                                       rotate = TRUE,
                                       xlab = "Cancer",
                                       ylab = "-Log10 p-value (N1 v. N0)",
                                       width = 0.4,
                                       sort.val = "asc",
                                       fill = "black",
                                       title = "T ",
                                       font.main = c(11, "bold"),
                                       font.x = c(10, "bold"),
                                       font.y = c(10, "bold"),
                                       font.xtickslab = c(10, "bold"),
                                      font.ytickslab = c(4, "bold"),) + geom_hline(yintercept = 1.30103, linetype = "dashed", color = "red")
    # FGA bar plot
    fga.utest <- filter(log.node.utest, cin == "fga")
    fga.barplot <- ggbarplot(fga.utest,
                                       x = "project", y = "p",
                                       rotate = TRUE,
                                       xlab = "Cancer",
                                       ylab = "-Log10 p-value (N1 v. N0)",
                                       width = 0.4,
                                       sort.val = "asc",
                                       fill = "black",
                                       title = " ",
                                       font.main = c(11, "bold"),
                                       font.x = c(10, "bold"),
                                       font.y = c(10, "bold"),
                                       font.xtickslab = c(10, "bold"),
                                      font.ytickslab = c(4, "bold"),) + geom_hline(yintercept = 1.30103, linetype = "dashed", color = "red")
    # CNA bar plot
    cna.utest <- filter(log.node.utest, cin == "cna")
    cna.barplot <- ggbarplot(cna.utest,
                                       x = "project", y = "p",
                                       rotate = TRUE,
                                       xlab = "Cancer",
                                       ylab = "-Log10 p-value (N1 v. N0)",
                                       width = 0.4,
                                       sort.val = "asc",
                                       fill = "black",
                                       title = " ",
                                       font.main = c(11, "bold"),
                                       font.x = c(10, "bold"),
                                       font.y = c(10, "bold"),
                                       font.xtickslab = c(10, "bold"),
                                      font.ytickslab = c(4, "bold"),) + geom_hline(yintercept = 1.30103, linetype = "dashed", color = "red")
   
     # Modified TAI bar plot
    modified.tai.utest <- filter(log.node.utest, cin == "modified_tai")
    modified.tai.barplot <- ggbarplot(modified.tai.utest,
                                       x = "project", y = "p",
                                       rotate = TRUE,
                                       xlab = "Cancer",
                                       ylab = "-Log10 p-value (N1 v. N0)",
                                       width = 0.4,
                                       sort.val = "asc",
                                       fill = "black",
                                       title = " ",
                                       font.main = c(11, "bold"),
                                       font.x = c(10, "bold"),
                                       font.y = c(10, "bold"),
                                       font.xtickslab = c(10, "bold"),
                                      font.ytickslab = c(4, "bold"),) + geom_hline(yintercept = 1.30103, linetype = "dashed", color = "red")
    
    # Tumor Stage Bar Plot
    node.barplot <- ggarrange(base.segments.barplot + rremove("xlab"),
                                     break.points.barplot + rremove("xlab"),
                                     tai.barplot + rremove("xlab"),
                                     fga.barplot + rremove("xlab"),
                                     cna.barplot + rremove("xlab"),
                                     modified.tai.barplot + rremove("xlab"),
                                     ncol = 1, nrow = 6)
    node.barplot <- annotate_figure(node.barplot, 
                    bottom = text_grob("-Log10 p-value (N1 v. N0)"))
    return(node.barplot)
}
}
tumor.stage.barplot <- get_utest_graphs(tnm.category = "tumor.stage")
metastasis.barplot <-  get_utest_graphs(tnm.category = "metastasis")
node.barplot <-  get_utest_graphs(tnm.category = "node")
tnm.barplot <- ggarrange(tumor.stage.barplot,
                         metastasis.barplot,
                         node.barplot,
                           ncol = 3,
                           nrow = 1)

tnm.barplot
```